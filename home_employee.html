<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Smart Job Hunting - Employee View</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Orbitron', sans-serif;
      margin: 0;
      padding: 0;
      line-height: 1.6;
      background-color: #0a0a0a;
      color: #00ffff;
      text-align: center;
    }

    header {
      background: #001f33;
      color: #00ffff;
      padding: 2rem 1rem;
      text-shadow: 0 0 10px #00ffff, 0 0 30px #00ffff33;
    }

    h1 {
      font-size: 2.8rem;
      margin-bottom: 0.3rem;
    }

    #welcome {
      font-size: 1.3rem;
      color: #88f9ff;
      margin-top: 0.5rem;
    }

    h2 {
      margin-bottom: 1rem;
      font-size: 1.5rem;
      color: #88f9ff;
    }

     ul {
      list-style-type: "ü§ñ ";
      padding-left: 1.5rem;
      max-width: 600px;
      margin: 0 auto;
      text-align: left;
      color: #88f9ff;
    }

    .robot-image {
      margin-top: 1.5rem;
    }

    .robot-image img {
      max-width: 300px;
      width: 100%;
      border-radius: 12px;
      box-shadow: 0 0 20px #00ffffaa;
    }

    .container {
      padding: 2rem;
      max-width: 900px;
      margin: auto;
    }

    .cta {
      margin: 2rem 0;
    }

    .cta button {
      margin: 0.5rem;
      padding: 0.75rem 1.5rem;
      background-color: #00ffff;
      color: #0a0a0a;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 0 20px #00ffffaa;
      transition: all 0.3s ease;
      font-weight: bold;
    }

    .cta button:hover {
      background-color: #00cccc;
      box-shadow: 0 0 30px #00ffffdd;
    }

    .robot-container {
     display: flex;
     justify-content: center;
     margin-top: 20px;
    }

    .robot-container ul {
  list-style-type: "ü§ñ ";
  padding-left: 1.5rem;
  text-align: left;
   }

    ul {
      list-style-type: "ü§ñ ";
      padding-left: 1.5rem;
      max-width: 600px;
      margin: auto;
      text-align: left;
      color: #88f9ff;
    }

    #resumeSection {
      margin-top: 2rem;
    }

    .resume-card {
      background-color: #001f33;
      padding: 1rem;
      margin: 1rem auto;
      border-radius: 8px;
      max-width: 600px;
      box-shadow: 0 0 10px #00ffff33;
      position: relative;
      text-align: left;
      color: #88f9ff;
    }

    .delete-resume-btn {
      margin-top: 0.75rem;
      padding: 0.5rem 1rem;
      background-color: #dc3545;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s ease;
    }

    .delete-resume-btn:hover {
      background-color: #b02a37;
    }

    .set-preferences-btn {
      margin-top: 0.75rem;
      padding: 0.5rem 1rem;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s ease;
      margin-left: 0.5rem;
    }

    .set-preferences-btn:hover {
      background-color: #1e7e34;
    }

    .preferences-saved-msg {
      margin-top: 10px;
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
      padding: 10px;
      border-radius: 6px;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .preferences-saved-msg svg {
      width: 24px;
      height: 24px;
      fill: #155724;
    }

    footer {
      margin-top: 3rem;
      padding: 1rem 0;
      background-color: #001f33;
      color: #00ffff;
      font-size: 0.9rem;
    }

    footer a {
      color: #00ffff;
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <script>
    // Run EULA check and welcome message logic
    window.addEventListener('DOMContentLoaded', () => {
      checkEULA();
      setWelcomeMessage();
      fetchResumes();
    });

    async function checkEULA() {
      try {
        const res = await fetch('/api/check-eula', { credentials: 'include' });
        const data = await res.json();
        if (!data.agreed) {
          window.location.href = 'eula.html';
        }
      } catch (err) {
        console.error('‚ùå Failed to check EULA:', err);
        window.location.href = 'eula.html';
      }
    }

    async function setWelcomeMessage() {
      let name = sessionStorage.getItem('username');

      if (!name) {
        try {
          const res = await fetch('/api/me', { credentials: 'include' });
          const data = await res.json();
          name = data.name || 'Job Seeker';
          sessionStorage.setItem('username', name);
        } catch (err) {
          console.error('‚ùå Could not fetch user info:', err);
          name = 'Job Seeker';
        }
      }

      document.getElementById('welcome').textContent = `Welcome, ${name}!`;
    }
  </script>

  <header>
    <h1>AI Job Hunt</h1>
    <p id="welcome">Welcome, Job Seeker!</p>
    <h2>Your AI-Powered Recruiter</h2>
    <div class="robot-container" style="text-align: center; margin-top: 20px;">  
       <ul>
          <li>AI Recruiter Robot</li>
       </ul>
    </div>

  </header>

  <div class="container">
    <section class="cta">
      <button onclick="location.href='upload_resume.html'">Upload Resume</button>
    </section>

    <section id="resumeSection">
      <h2>Your Uploaded Resumes</h2>
      <div id="resumeInfo">Loading...</div>
    </section>

    <section class="features">
      <h2>Features</h2>
      <ul>
        <li>Intelligent Resume Parsing</li>
        <li>AI Job Matching Based on Pay, Location, and Title</li>
        <li>Filters Out Misleading Job Ads</li>
        <li>Personalized Cover Letters</li>
        <li>Tracks Applications and Status</li>
      </ul>
    </section>
  </div>

  <script>
    function getQueryParams() {
      const params = {};
      location.search
        .substring(1)
        .split("&")
        .forEach((pair) => {
          const [key, value] = pair.split("=");
          if (key) params[key] = decodeURIComponent(value || "");
        });
      return params;
    }

    async function fetchResumes() {
      const container = document.getElementById('resumeInfo');
      container.innerHTML = 'Loading...';

      try {
        const res = await fetch('/api/resumes', { credentials: 'include' });
        const resumes = await res.json();

        if (!resumes.length) {
          container.innerHTML = '<p>No resumes uploaded yet.</p>';
          return;
        }

        const params = getQueryParams();
        let savedResumeId = params.preferencesSavedResumeId || sessionStorage.getItem('savedResumeId') || null;

        container.innerHTML = '';
        resumes.forEach((resume) => {
          const div = document.createElement('div');
          div.className = 'resume-card';

          div.innerHTML = `
            <p><strong>Filename:</strong> ${resume.originalName?.trim() || resume.fileName || 'Unknown'}</p>
            <button class="delete-resume-btn" onclick="deleteResume('${resume._id}')">Delete Resume</button>
            <button class="set-preferences-btn" onclick="setPreferences('${resume._id}')">Set Preferences</button>
          `;

          if (savedResumeId && savedResumeId === resume._id) {
            const msg = document.createElement('div');
            msg.className = 'preferences-saved-msg';
            msg.innerHTML = `
              <svg viewBox="0 0 24 24">
                <path d="M9 16.2l-3.5-3.5 1.41-1.41L9 13.38l7.09-7.09 1.41 1.41z"/>
              </svg>
              Preferences saved successfully! Please wait for employers to contact you.
            `;
            div.appendChild(msg);
          }

          container.appendChild(div);
        });
      } catch (err) {
        console.error('‚ùå Error loading resumes:', err);
        container.innerHTML = '<p>Failed to load resumes.</p>';
      }
    }

    async function deleteResume(resumeId) {
      if (!confirm('Are you sure you want to delete this resume?')) return;

      try {
        const res = await fetch(`/api/upload-resume/${resumeId}`, {
          method: 'DELETE',
          credentials: 'include',
        });

        if (res.ok) {
          alert('Resume deleted.');
          fetchResumes();
        } else {
          alert('Failed to delete resume.');
        }
      } catch (err) {
        console.error('‚ùå Error deleting resume:', err);
        alert('Error deleting resume.');
      }
    }

    function setPreferences(resumeId) {
      window.location.href = `survey.html?resumeId=${resumeId}`;
    }
  </script>

  <footer>
    &copy; 2025 Microwave Master. Contact: <a href="mailto:chrisvrfsoftware@gmail.com">chrisvrfsoftware@gmail.com</a>
  </footer>
</body>
</html>
